<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1.0" http-equiv="Content-Type"
		content="text/html; charset=utf-8">
	<title>æ ¡å›­å¸®å¸®ç½‘-ä¸ªäººä¸­å¿ƒ</title>
	<!-- å¼•å…¥ Bootstrap -->
	<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
	<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
	<script src="js/util.js"></script>
	<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
	<link rel="bookmark" type="image/x-icon" href="pic/favicon.ico" />
	<link rel="shortcut icon" href="pic/favicon.ico">
</head>

<body>
	<!-- æé—®æ¨¡æ€æ¡†ï¼ˆModalï¼‰ -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—
					</button>
					<h4 class="modal-title" id="myModalLabel">æé—®</h4>
				</div>
				<div class="modal-body">
					<div>
						<div class="row clearfix">
							<div class="col-md-12 column">
								<div class="alert alert-dismissable alert-info">
									<button type="button" class="close" data-dismiss="alert"
										aria-hidden="true">Ã—</button>
									<h4>æé—®é¡»çŸ¥</h4>
									<strong>æ³¨æ„ï¼</strong>
									è¯·æå‡ºæœ‰æ„ä¹‰çš„é—®é¢˜ï¼Œè¯·å‹¿å‘è¡¨çŒæ°´å†…å®¹ã€‚
									<!-- <a href="#" class="alert-link">ã€é—®é¢˜ç®¡ç†æ¡ä¾‹ã€‘</a> -->
								</div>
							</div>
						</div>
					</div>
					<form class="form-horizontal" role="form" target="iframe">
							
						<div class="form-group">
							<label for="inputQue" class="col-sm-2 control-label">é—®é¢˜</label>
							<div class="col-sm-9">
								<input type="text" class="form-control" id="inputQue" maxlength="200" placeholder="200å­—ä»¥å†…"/>
								<span id="inputQueTip" style="display:none;color:red;"></span>
							</div>
						</div>
						<div class="form-group">
    						<label for="describeQue" class="col-sm-2 control-label">æè¿°</label>
							<div class="col-sm-9">
								<textarea class="form-control" rows="3" id="describeQue"
								 style="max-width: 100%" maxlength="2000" placeholder="2000å­—ä»¥å†…"></textarea>
								 <span id="describeQueTip" style="display:none;color:red;"></span>
							</div>
						  </div>
						  <div class="form-group">
							<label for="questionType" class="col-sm-2 control-label" >é—®é¢˜ç±»å‹</label>
							<div class="col-sm-9">
							<select class="form-control" id="selectKind">
							  <option>å­¦ä¸šé—®ç­”</option>
							  <option>å°±ä¸šæŒ‡å¯¼</option>
							  <option>å­¦ä¹ èµ„æº</option>
							  <option>ç”Ÿæ´»ç›¸å…³</option>
							  <option>å…¶ä»–é—®é¢˜</option>
							</select>
						</div>
						  </div>
						  <div style="text-align: center;">
							<label><input type="checkbox" id="anonymousQuest"/> åŒ¿åæé—®</label>
						</div>
						<div style="text-align:center">
							<button type="button" class="btn btn-primary" onclick="postQuestion()">æ äº¤</button>
							<button type="button" class="btn btn-default" data-dismiss="modal" id="closeQue" onclick="resetQuestTextBox();">å…³ é—­</button>
						</div>
					</form>
					<iframe id="iframe" name="iframe" style="display:none;"></iframe>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal-dialog -->
	</div><!-- /.modal -->

	<div class="container">
		<div class="row clearfix">
			<div class="col-md-12 column">
				<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle" data-toggle="collapse"
							data-target="#bs-example-navbar-collapse-1"> <span class="sr-only">Toggle
								navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span
								class="icon-bar"></span></button> <a class="navbar-brand" href="#"><img
								src="pic/icon.png" height="40" width="40" vsapce="50" style="float:left" /></a>
					</div>

					<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
						<ul class="nav navbar-nav">
							<li class="dropdown">
								<a href="index.html">é¦–é¡µ</a>
							</li>
							<li>
								<a href="#" data-toggle="modal" data-target="#myModal">æé—®</a>
							</li>
							<li class="dropdown">
								<a href="questionList.html">ç­‰ä½ æ¥ç­”</a>
							</li>
							<li class="dropdown" id="tempBlock">
							</li>

						</ul>
						<form class="navbar-form navbar-left" role="search" target="iframe">
							<div class="form-group">
								<input type="text" class="form-control" id="searchContent" />
							</div> <button type="submit" class="btn btn-default" onclick="search();">ğŸ”</button>
						</form>
						<iframe id="iframe" name="iframe" style="display:none;"></iframe>
						<ul class="nav navbar-nav navbar-right">
							<li>
								<a href="myMessage.html">ğŸ””</a>
							</li>
							<li>
								<a href="usrInfo.html">æˆ‘çš„&nbsp;&nbsp;&nbsp;</a>
							</li>
							<li>
								<a href="login.html" onclick="exit();">é€€å‡ºç™»å½•&nbsp;&nbsp;&nbsp;</a>
							</li>
						</ul>
					</div>


				</nav>
				<div class="page-header" style="top:130">
					<br />
					<h1>
						ä¸ªäººä¸­å¿ƒ <small></small>
					</h1>
				</div>
			</div>
		</div>
		<div class="row clearfix">
			<div class="col-md-8 column">
				<ul class="nav nav-tabs">
					<li>
						<a href="usrInfo.html">å…³æ³¨é—®é¢˜</a>
					</li>
					<li>
						<a href="myAnswer.html">æˆ‘çš„å›ç­”</a>
					</li>
					<li>
						<a href="myQuestion.html">æˆ‘çš„æé—®</a>
					</li>
					<li>
						<a href="myMessage.html">æˆ‘çš„æ¶ˆæ¯</a>
					</li>
					<li>
						<a href="exchange.html">å¥–åŠ±å…‘æ¢</a>
					</li>
					<li class="dropdown pull-right">
						<a href="#" data-toggle="dropdown" class="dropdown-toggle">å…¶ä»–<strong class="caret"></strong></a>
						<ul class="dropdown-menu">
							<li class="active">
								<a href="editPwd.html">ä¿®æ”¹å¯†ç </a>
							</li>
							<li class="disabled">
								<a href="#">ä¿®æ”¹ä¿¡æ¯</a>
							</li>
							<li class="divider">
							</li>
							<li>
								<a href="login.html">é€€å‡ºç™»å½•</a>
							</li>
						</ul>
					</li>
				</ul>
				<!-- å†…å®¹å†™åœ¨è¿™é‡Œï¼ï¼ï¼ -->
				<!--å¯†ç æ¡†åˆ¤æ–­å¼€å§‹-->
				<script src="adminInterface/assets/js/biz/isValidID.js"></script>
				<script type="text/javascript">
					$(document).ready(function () {
						var error = false;

						$("#newpass").blur(function () {
							var newpass = $("#newpass").val();
							if (newpass == '') {
								showError('newpass', 'æ–°å¯†ç ä¸èƒ½ä¸ºç©º');
								error = true;
							}
							else {
								$("#newpass").css({ "border-color": "green" });
								$("#newpassTip").css({ "display": "none" });
							}
						});

						$("#newpassAgain").blur(function () {
							var newpass = $("#newpass").val();
							if (newpass == '') {
								showError('newpass', 'æ–°å¯†ç ä¸èƒ½ä¸ºç©º');
								error = true;
								return;
							}

							var newpassAgain = $("#newpassAgain").val();
							if (newpassAgain != newpass) {
								showError('newpassAgain', 'ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´');
								error = true;
							}
							else {
								$("#newpassAgain").css({ "border-color": "green" });
								$("#newpassAgainTip").css({ "display": "none" });
							}
						});

						$("#submit").click(function (event) {
							$("#username").blur();
							$("#oldpass").blur();
							$("#newpass").blur();
							$("#newpassAgain").blur();

							if (!error) {
								var username = $("#username").val();
								var newpass = $("#newpass").val();
								$.post('modifyPassProcess.php', { flag: 3, username: username, newpass: newpass }, function (data) {
									$("#modifySuccess").css({ 'display': 'inline' });
								});
							}

							event.preventDefault();
							return false;
						});
					});

					function showError(formSpan, errorText) {
						$("#" + formSpan).css({ "border-color": "red" });
						$("#" + formSpan + "Tip").empty();
						$("#" + formSpan + "Tip").append(errorText);;
						$("#" + formSpan + "Tip").css({ "display": "inline" });
					}
				</script>
				<!--å¯†ç æ¡†åˆ¤æ–­ç»“æŸ-->
				<div class=".container" style="margin-top:100px;width:250%;">
					<form class="form-horizontal" role="form" style="border: 1;">
						<div class="form-group">
							<label for="newpass" class="col-sm-2 control-label">è¾“å…¥æ–°å¯†ç </label>
							<div class="col-sm-10">
								<input type="password" class="form-control" style="width:250px;" id="newpass"
									placeholder="New Password"><span id="newpassTip"
									style="display:none;color:red;"></span>
							</div>
						</div>
						<div class="form-group">
							<label for="newpassAgain" class="col-sm-2 control-label">ç¡®è®¤æ–°å¯†ç </label>
							<div class="col-sm-10">
								<input type="password" class="form-control" style="width:250px;" id="newpassAgain"
									placeholder="Again New Password"><span id="newpassAgainTip"
									style="display:none;color:red;"></span>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-2 control-label">èº«ä»½è¯å·ç </label>
							<div class="col-sm-10">
								<input type="text" id="ID" placeholder="è¾“å…¥èº«ä»½è¯å·ç " class="form-control"
									 label="èº«ä»½è¯å·" maxlength="18"  style="width:250px;"/>
								<span id="IDTip" style="display:none;color:red;"></span>
							</div>
						</div>
						<div class="form-group">
							<label class="col-sm-2 control-label"> </label>
							<button type="submit" class="btn btn-primary" id="submit" style="text-align:center;"
								onclick="submitPwdChange();">ç¡®è®¤ä¿®æ”¹</button>
						</div>
					</form>
				</div>

			</div>
			<div class="col-md-4 column">
				<img alt="140x140" src="http://cdn.ibootstrap.cn/lorempixel.com/140/140/default.jpg"
					class="img-circle" />
				<dl>
					<dt>å§“å</dt>
					<dd id="infoName">å¼ ä¸‰</dd>
					<dt>å­¦å·</dt>
					<dd id="infoAccount">221701300</dd>
				</dl>
				<dl>
					<dt>ç­‰çº§</dt>
					<dd id="infoLevel">0</dd>
					<dt>ç§¯åˆ†</dt>
					<dd id="infoScore">0</dd>
				</dl>
				<dl>
					<dt>æé—®</dt>
					<dd id="infoQuesNum">3</dd>
					<dt>å›ç­”</dt>
					<dd id="infoRespNum">0</dd>
					<dt>å…³æ³¨</dt>
					<dd id="infoFocusNum">0</dd>
				</dl>
			</div>
		</div>







	</div>
	<script src="assets/js/biz/isValidID.js"></script>
	<script>
		var changeFlag;//æ›´æ”¹å¯†ç æ ‡å¿—ä½ï¼Œå‰ç«¯åˆ¤æ–­é”™è¯¯ä¸å‘é€æ•°æ®è‡³åç«¯
		//é¡µé¢åŠ è½½æ—¶å¯åŠ¨é¡µé¢
		$(document).ready(function (e) {
			var error = false;
			//è·å–å½“å‰ç™»å½•ç”¨æˆ·
			var userVO = localStorage.getExpire("userVO");
			//è·å–ç”¨æˆ·
			if (userVO == null) {//ç™»å½•è¿‡æœŸï¼Œè¿”å›ç™»å½•é¡µé¢
				alert("ç™»å½•è¿‡æœŸ,è¯·é‡æ–°ç™»å½•");
				window.location.href = "login.html";
			} else {
				var b = document.getElementById("infoName");
				b.innerHTML = userVO.user.name;
				initInfo(userVO);
			}
			$("#ID").blur(function () {
				var account = $("#ID").val();
				if(account.length == 0){
					showError('ID', 'èº«ä»½è¯ä¸èƒ½ä¸ºç©º');
					error = true;
					changeFlag = false;
				}else if (IdCardValidate(account) == false) {
					showError('ID', 'èº«ä»½è¯å·ç éæ³•');
					error = true;
					changeFlag = false;
				}else {
					$("#ID").css({ "border-color": "green" });
					$("#IDTip").css({ "display": "none" });
					changeFlag = true;
				}
			});
			getBlock();
			questTextBoxErrorInit();
		});


			function showError(formSpan, errorText) {
				$("#" + formSpan).css({ "border-color": "red" });
				$("#" + formSpan + "Tip").empty();
				$("#" + formSpan + "Tip").append(errorText);;
				$("#" + formSpan + "Tip").css({ "display": "inline" });
			}

			//æäº¤ä¿®æ”¹å¯†ç è¯·æ±‚
			function submitPwdChange() {
				if(changeFlag == false){//å‰ç«¯åˆ¤æ–­é”™è¯¯ä¸å‘é€æ•°æ®è‡³åç«¯
					return;
				}
				var pwd1Temp = $.trim($("#newpass").val());
				var pwd2Temp = $.trim($("#newpassAgain").val());
				var idCardTemp = $.trim($("#ID").val());

				if(pwd1Temp.length == 0){
					showError('newpass', 'æ–°å¯†ç ä¸èƒ½ä¸ºç©º');
					return;
				}

				if(pwd2Temp.length == 0){
					showError('newpassAgain', 'éªŒè¯å¯†ç ä¸èƒ½ä¸ºç©º');
					return;	
				}

				if(idCardTemp.length == 0){
					showError('ID', 'èº«ä»½è¯ä¸èƒ½ä¸ºç©º');
					return;
				}

				var pwd1 = window.btoa(pwd1Temp);
				var pwd2 = window.btoa(pwd2Temp);
				var idCard = window.btoa(idCardTemp);
				if (pwd1 != pwd2) {
					return;
				}
				var t = userVO;
				//èº«ä»½è¯å·
				t.user.idCard = idCard;
				//å¯†ç 
				t.user.password = pwd1;
				//æäº¤ä¿®æ”¹
				$.ajax({
					url: "http://localhost:8888/user",
					type: "put",
					data: JSON.stringify(t.user),
					beforeSend: function (request) {
						request.setRequestHeader("token", userVO.token);
					},
					contentType: 'application/json;charset=utf-8',
					success: function (data) {
						if (data.code == 200) {
							//éªŒè¯æˆåŠŸ
							userVO = userVO;
							alert("ä¿®æ”¹æˆåŠŸ,è¯·é‡æ–°ç™»å½•");
							window.location.href = "login.html"
						} else {
							//éªŒè¯å¤±è´¥
							showError('ID', 'èº«ä»½è¯ä¸è´¦å·ä¸åŒ¹é…');
						}
					}
				});
			}
	</script>
</body>

</html>