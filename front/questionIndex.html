<!DOCTYPE html>
<html>
   <head>
      	<title>æ ¡å›­å¸®å¸®ç½‘-é—®é¢˜è¯¦æƒ…</title>
      	<meta name="viewport" content="width=device-width, initial-scale=1.0" http-equiv="Content-Type" content="text/html; charset=utf-8">
      	<!-- å¼•å…¥ Bootstrap -->
      	<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
		<script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
		<script src="js/util.js"></script>
      	<link rel="bookmark"  type="image/x-icon"  href="pic/favicon.ico"/>
      	<link rel="shortcut icon" href="pic/favicon.ico">
   </head>
   <body>
      	<!-- æé—®æ¨¡æ€æ¡†ï¼ˆModalï¼‰ -->
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—
						</button>
						<h4 class="modal-title" id="myModalLabel">æé—®</h4>
					</div>
					<div class="modal-body">
						<div >
							<div class="row clearfix">
								<div class="col-md-12 column">
									<div class="alert alert-dismissable alert-info">
					 					<button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button>
											<h4>æé—®é¡»çŸ¥</h4>
											<strong>æ³¨æ„ï¼</strong>
											è¯·æå‡ºæœ‰æ„ä¹‰çš„é—®é¢˜ï¼Œè¯·å‹¿å‘è¡¨çŒæ°´å†…å®¹ã€‚
											<a href="#" class="alert-link">ã€é—®é¢˜ç®¡ç†æ¡ä¾‹ã€‘</a>
									</div>
								</div>
							</div>
						</div>
					<form class="form-horizontal" role="form" target="iframe">
							
						<div class="form-group">
							<label for="inputQue" class="col-sm-2 control-label">é—®é¢˜</label>
							<div class="col-sm-9">
								<input type="text" class="form-control" id="inputQue" />
							</div>
						</div>
						<div class="form-group">
    						<label for="describeQue" class="col-sm-2 control-label">æè¿°</label>
							<div class="col-sm-9">
    							<textarea class="form-control" rows="3" id="describeQue" style="max-width: 100%"></textarea>
							</div>
						  </div>
						  <div class="form-group">
							<label for="questionType" class="col-sm-2 control-label">é—®é¢˜ç±»å‹</label>
							<div class="col-sm-9">
							<select class="form-control" id="selectKind">
							  <option>å­¦ä¸šé—®ç­”</option>
							  <option>å°±ä¸šæŒ‡å¯¼</option>
							  <option>å­¦ä¹ èµ„æº</option>
							  <option>ç”Ÿæ´»ç›¸å…³</option>
							  <option>å…¶ä»–é—®é¢˜</option>
							</select>
						</div>
						  </div>
						  <div style="text-align: center;">
							<label><input type="checkbox" id="anonymousQuest"/> åŒ¿åæé—®</label>
						</div>
						<div style="text-align:center">
							<button type="button" class="btn btn-primary" onclick="postQuestion()">æ äº¤</button>
							<button type="button" class="btn btn-default" data-dismiss="modal" id="closeQue">å…³ é—­</button>
						</div>
					</form>
					<iframe id="iframe" name="iframe" style="display:none;"></iframe>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
    <div class="container">
	<div class="row clearfix">
		<div class="col-md-12 column">
			<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
				<div class="navbar-header">
					 <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"> <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button> <a class="navbar-brand" href="#"><img src="pic/icon.png" height="40" width="40" vsapce="50" style="float:left"/></a>
				</div>
				
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1" >
					<ul class="nav navbar-nav">
						<li class="dropdown">
							 <a href="index.html">é¦–é¡µ</a>
						</li>
						<li>
							 <a href="#" data-toggle="modal" data-target="#myModal">æé—®</a>
						</li>
						<li class="dropdown">
							<a href="questionList.html">ç­‰ä½ æ¥ç­”</a>
						</li>
						<li class="dropdown"  id="tempBlock">
					   </li>
					   
					</ul>
					<form class="navbar-form navbar-left" role="search" target="iframe">
						<div class="form-group">
							<input type="text" class="form-control" id="searchContent"/>
						</div> <button type="submit" class="btn btn-default" onclick="search();">ğŸ”</button>
					</form>
					<iframe id="iframe" name="iframe" style="display:none;"></iframe>
					<ul class="nav navbar-nav navbar-right">
						<li>
							 <a href="myMessage.html">ğŸ””</a>
						</li>
						<li>
							 <a href="usrInfo.html">æˆ‘çš„&nbsp;&nbsp;&nbsp;</a>
						</li>
						<li>
							<a href="login.html" onclick="exit();">é€€å‡ºç™»å½•&nbsp;&nbsp;&nbsp;</a>
						</li>
					</ul>
				</div>
				

			</nav>
			<div class="page-header" style="top:130">
				<br/>
				<h1>
					é—®é¢˜è¯¦æƒ… <small><span class="label label-default" id="kind"></span></small>	
				</h1>
			</div>
		</div>
	</div>
	


	<div class="container">
		<div class="row clearfix">
			<div class="col-md-8 column">
				<h3 class="text-left" id="questionTitle"></h3>
				<p id="questionContent"></p>

				<div class="col-md-12 column" >
					<div id="login_btn" class="login_log" style="display: inline;">
						<br/>
						<button type="button" class="btn btn-sm btn-primary" id="attentionQuestion" onclick="attentionQuestion();"></button>
						&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					</div>
					<button type="button" class="btn btn-sm btn-danger" id="reportQuestion" onclick="reportQuesion();"></button>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<div id="login_btn" class="login_log" style="display: inline;">
						<a id="modal-706894" class="btn btn-success btn-sm" href="#addAnswer" role="button" class="btn btn-default btn-success" data-toggle="modal">å›ç­”é—®é¢˜</a>
					</div>
				</div>
				 
			</div>
			<div class="col-md-4 column">
				<div class="col-md-6 column">
					<p><strong>åˆ›å»ºæ—¶é—´</strong></p>
					<p id="questionCreateTime" style="display: inline-flex;"></p>
			   </div>
			   <div class="col-md-6 column">
				<p><strong>å›å¤æ•°</strong></p>
				<p id="responseNum" style="display: inline-flex;"></p>
			   </div>
			   <div class="col-md-12 column" >
					<strong>æé—®è€…</strong>
					<h4 id="authorName"></h4>

			   </div>
			   <div class="col-md-12 column" style="bottom: 0;">
				<br/>
				
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;


				</div>
				<!-- å›ç­”æ¨¡æ€æ¡†ï¼ˆModalï¼‰ -->
				<div class="modal fade" id="addAnswer" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog">
							<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—
								</button>
								<h4 class="modal-title" id="myModalLabel">å›ç­”</h4>
							</div>
							<div class="modal-body">
								<div >
									<div class="row clearfix">
										<div class="col-md-12 column">
											<div class="alert alert-dismissable alert-info">
							 					<button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button>
													<h4>å›ç­”é¡»çŸ¥</h4>
													<strong>æ³¨æ„ï¼</strong>
													è¯·åšå‡ºæœ‰æ„ä¹‰çš„å›ç­”ï¼Œè¯·å‹¿å‘è¡¨çŒæ°´å†…å®¹ã€‚
													<a href="#" class="alert-link">ã€å›ç­”ç®¡ç†æ¡ä¾‹ã€‘</a>
											</div>
										</div>
									</div>
								</div>
							<form class="form-horizontal" role="form" target="iframe">
								<div class="form-group">
    								<label for="describeQue" class="col-sm-2 control-label">å†…å®¹</label>
									<div class="col-sm-9">
    									<textarea class="form-control" rows="3" id="cresponseContent" style="max-width: 100%"></textarea>
									</div>
								</div>
								<div style="text-align: center;">
									<label><input type="checkbox" id="anonymousResp"/> åŒ¿åå›ç­”</label>
								</div>
								<div style="text-align:center">
									<button type="button" class="btn btn-primary" onclick="postResponse()">æ äº¤</button>
									<button type="button" class="btn btn-default" data-dismiss="modal" id="closeButton">å…³ é—­</button>
								</div>
							</form>
							<iframe id="iframe" name="iframe" style="display:none;"></iframe>
						</div>
					</div><!-- /.modal-content -->
				</div><!-- /.modal-dialog -->
			</div><!-- /.modal -->
			<!-- å›ç­”æ¨¡æ€æ¡†ç»“æŸï¼ˆModalï¼‰ -->
				
			</div>
		</div>
		<hr/>
			
		<!--é¡µé¢ä¸»è¦å†…å®¹å®¹å™¨-->
		<div id="responseDiv">
			<!--é—®é¢˜åˆ—è¡¨å®¹å™¨-->
			<div id="responseList">
				<!--ä¸€ä¸ªå›å¤è®°å½•-->
			</div>

			<ul class="pagination pagination-lg" id="pageButtons">
			</ul>
			<p id = "divEnd"></p>
		</div>

		<!-- å†…å®¹å†™åœ¨è¿™é‡Œï¼ï¼ï¼ -->

	</div>
	
	</div>
	
</body>
   
<script>
	//å›å¤åˆ†é¡µåˆ—è¡¨
	var responsePage = {
		"pageIndex":1,
		"count":5
	}
	//æœ¬é¡µé¢çš„é—®é¢˜id
	var id = getQueryVariable("id");
	//å›å¤åˆ—è¡¨url
	var responsePath = "http://localhost:8888/responses/" + id + "/" + userVO.user.id;
	//å›å¤å®¹å™¨
    var responseDiv = document.getElementById("responseDiv");
    //å­˜æ”¾å›å¤åˆ—è¡¨çš„div
	var responseList = document.getElementById("responseList");
	//åˆ†é¡µçš„æŒ‰é’®åˆ—è¡¨
    var pageButtons = document.getElementById("pageButtons");
	//ä¸Šä¸€é¡µæŒ‰é’®
	var preButton = document.getElementById("previous");
    //ä¸‹ä¸€é¡µæŒ‰é’®
    var nextButton = document.getElementById("next");	

	//å›ç­”æ–‡æœ¬æŠ˜å 
	function show1(){ 
	var box = document.getElementById("box1"); 
	var text = box.innerHTML; 
	var newBox = document.createElement("div"); 
	var btn = document.createElement("a"); 
	newBox.innerHTML = text.substring(0,200); 
	btn.innerHTML = text.length > 200 ? "...æ˜¾ç¤ºå…¨éƒ¨" : ""; 
	btn.href = "###"; 
	btn.onclick = function(){ 
	if (btn.innerHTML == "...æ˜¾ç¤ºå…¨éƒ¨"){ 
	btn.innerHTML = "æ”¶èµ·"; 
	newBox.innerHTML = text; 
	}else{ 
	btn.innerHTML = "...æ˜¾ç¤ºå…¨éƒ¨"; 
	newBox.innerHTML = text.substring(0,200); 
	} 
	} 
	box.innerHTML = ""; 
	box.appendChild(newBox); 
	box.appendChild(btn); 
	} 
	function show2(){ 
	var box = document.getElementById("box2"); 
	var text = box.innerHTML; 
	var newBox = document.createElement("div"); 
	var btn = document.createElement("a"); 
	newBox.innerHTML = text.substring(0,200); 
	btn.innerHTML = text.length > 200 ? "...æ˜¾ç¤ºå…¨éƒ¨" : ""; 
	btn.href = "###"; 
	btn.onclick = function(){ 
	if (btn.innerHTML == "...æ˜¾ç¤ºå…¨éƒ¨"){ 
	btn.innerHTML = "æ”¶èµ·"; 
	newBox.innerHTML = text; 
	}else{ 
	btn.innerHTML = "...æ˜¾ç¤ºå…¨éƒ¨"; 
	newBox.innerHTML = text.substring(0,200); 
	} 
	} 
	box.innerHTML = ""; 
	box.appendChild(newBox); 
	box.appendChild(btn); 
	} 
    //é—®é¢˜å®¹å™¨
    var questionDiv = document.getElementById("questionDiv");
    //å­˜æ”¾é—®é¢˜åˆ—è¡¨çš„div
	var questionList = document.getElementById("quetionList");
	//åˆ†é¡µçš„æŒ‰é’®åˆ—è¡¨
    var pageButtons = document.getElementById("pageButtons");
	//ä¸Šä¸€é¡µæŒ‰é’®
	var preButton = document.getElementById("previous");
    //ä¸‹ä¸€é¡µæŒ‰é’®
	var nextButton = document.getElementById("next");
	//é—®é¢˜æ¨¡å—ç»“æŸæ ‡è®°å…ƒç´ 
	var divEnd = document.getElementById("divEnd");
    //å½“å‰é¡µé¢æ˜¾ç¤ºçš„æ•°æ®(ä¼ é€’ç»™åç«¯çš„æ•°æ®)


    //é¡µé¢åŠ è½½æ—¶å¯åŠ¨é¡µé¢
    $(document).ready(function(e) {
		if(userVO == null){
			//ç™»å½•è¿‡æœŸ
			alert("ç™»å½•è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•");
			window.location.href = "login.html";
		}
		//åŠ è½½é—®é¢˜ä¿¡æ¯
		initQuestion();
		//åŠ è½½é—®é¢˜åˆ—è¡¨
		initResponseList();
		//è·å–ä¸´æ—¶æ¿å—
		getBlock();
    });
	

	
	//åˆå§‹åŒ–é—®é¢˜çš„è¯¦ç»†ä¿¡æ¯
	function initQuestion(){
		$.ajax({
			url: "http://localhost:8888/question/" + id + "/" + userVO.user.id,
			type: "get", 
			contentType: 'application/json;charset=utf-8',
			beforeSend: function (request) {
				request.setRequestHeader("token", userVO.token);
			},
			success: function (data) {
				if(data.code == 200){
					initQuestionBlock(data.data);
				}else if(data.code == 408){//æŸ¥è¯¢é—®é¢˜ä¸å­˜åœ¨
					alert(data.message);
					window.history.back();location.reload();//è¿”å›ä¸Šä¸€é¡µ
				}
			},
			error:function(){
				alert("æœåŠ¡å™¨é”™è¯¯,è¯·ç¨åå†è¯•");
			}
		});
	}

	//ç»™é—®é¢˜è¯¦æƒ…å†…å®¹èµ‹å€¼
	function initQuestionBlock(questionVO){
		var title = document.getElementById("questionTitle");
		title.innerHTML = questionVO.title;
		var content = document.getElementById("questionContent");
		content.innerHTML = questionVO.content;
		var responseNum = document.getElementById("responseNum");
		responseNum.innerHTML = questionVO.question.responseNum;
		var questionCreateTime = document.getElementById("questionCreateTime");
		questionCreateTime.innerHTML = questionVO.question.createTime;
		var questionAuthorName = document.getElementById("authorName");
		questionAuthorName.innerHTML = questionVO.authorName;4
		var attentionQuestionButton = document.getElementById("attentionQuestion");
		var reportQuestionButton = document.getElementById("reportQuestion");
		var kindText = document.getElementById("kind");
		kindText.innerHTML = questionVO.kind;
		if(questionVO.doesAttention == true){
			//å·²å…³æ³¨
			attentionQuestionButton.innerHTML = "å–æ¶ˆå…³æ³¨";
			attentionQuestionButton.setAttribute("flag",1);
		}else{
			//æœªå…³æ³¨
			attentionQuestionButton.innerHTML = "å…³æ³¨é—®é¢˜";
			attentionQuestionButton.setAttribute("flag",0);
		}

		if(questionVO.doesReported == true){
			//å·²æŠ•è¯‰
			reportQuestionButton.innerHTML = "å–æ¶ˆæŠ•è¯‰";
			reportQuestionButton.setAttribute("flag", 1);
		}else{
			//æœªæŠ•è¯‰
			reportQuestionButton.innerHTML = "æŠ•è¯‰é—®é¢˜";
			reportQuestionButton.setAttribute("flag", 0);
		}
	}

	//åˆå§‹åŒ–åŠ è½½é—®é¢˜åˆ—è¡¨
	function initResponseList(){
		changeQuestionPage(responsePage, responsePath)
	}

	//åŠ è½½æ›´æ–°å›å¤åˆ—è¡¨åˆ†é¡µ
	var list;
    function updateList(p){
		responsePage = p;
		//å½“é¡µçš„å›å¤åˆ—è¡¨
        list = responsePage.responses;
		list = Array.prototype.slice.call(list);
		responseDiv.removeChild(responseList);
		responseList = document.createElement("div");
        responseDiv.insertBefore(responseList, pageButtons);
        for(var i = 0; i < list.length; i++){
            //åˆ›å»ºå­˜æ”¾å•ä¸ªå›å¤çš„div
			var responseBlock = document.createElement("div");
			responseList.appendChild(responseBlock);
			//å›å¤å†…å®¹div
			var responseBox = document.createElement("div");
			responseBox.id = "box" + i;
			responseBlock.appendChild(responseBox);
            //åˆ›å»ºå­˜æ”¾å›å¤äººå§“åçš„<strong>æ ‡ç­¾
            var responser = document.createElement("strong");
			responser.innerHTML = list[i].authorName;
			responseBox.appendChild(responser);
            //åˆ›å»ºå­˜æ”¾å›å¤å†…å®¹çš„pæ ‡ç­¾
            var content = document.createElement("p");
            content.innerHTML = list[i].content;//é—®é¢˜æè¿°
			responseBox.appendChild(content);
			//åˆ›å»ºæŒ‰é’®div(ç‚¹èµã€ç‚¹ç­ã€æŠ•è¯‰)
			var buttonBox = document.createElement("div");
			buttonBox.className = "btn-group btn-group-sm";
			responseBlock.appendChild(buttonBox);
			//åˆ›å»ºç‚¹èµæŒ‰é’®
			var likeButton = document.createElement("button");
			likeButton.className = "btn btn-info btn-xs";
			likeButton.id = "like" + i;
			if(list[i].like == 1){
				//å·²èµ
				likeButton.innerHTML = "ğŸ‘å–æ¶ˆç‚¹èµ";
				likeButton.setAttribute("flag",1);	
			}else{
				//ç‚¹ç­æˆ–æ²¡éƒ½æ²¡æœ‰
				likeButton.innerHTML = "ğŸ‘ç‚¹èµ";
				likeButton.setAttribute("flag",0);
			}
			buttonBox.appendChild(likeButton);
			var responseId = list[i].response.id;
			console.info("likeResponse("  + responseId + ", "+ i + ", 'like');");
			likeButton.setAttribute("onclick","likeResponse("  + responseId + ", "+ i + ", 'like');")
			// likeButton.onclick =function(list){
			// 	console.info(list[i].content);
			// 	likeResponse(list[i].response.id, i, "like");
			// }	 
			//åˆ›å»ºç‚¹ç­æŒ‰é’®
			var disLikeButton = document.createElement("button");
			disLikeButton.id = "disLike" + i;
			disLikeButton.className = "btn btn-info btn-xs";
			if(list[i].like == -1){
				//æœ‰ç‚¹ç­è®°å½•
				disLikeButton.innerHTML = "ğŸ‘å–æ¶ˆç‚¹ç­";
				disLikeButton.setAttribute("flag", 1);
			}else{
				//ç‚¹èµæˆ–éƒ½æ²¡æœ‰
				disLikeButton.innerHTML = "ğŸ‘ç‚¹ç­";
				disLikeButton.setAttribute("flag",0)
			}
			buttonBox.appendChild(disLikeButton);
			disLikeButton.setAttribute("onclick","likeResponse("  + responseId + ", "+ i + ", 'disLike');")
			// disLikeButton.onclick = function(){
			// 	likeResponse(list[i].response.id, i, "disLike");
			// }
			//åˆ›å»ºæŠ•è¯‰æŒ‰é’®
			var reportButton = document.createElement("button");
			reportButton.className = "btn btn-danger btn-xs";
			if(list[i].doesReported == true){
				//æŠ•è¯‰è¿‡
				reportButton.innerHTML = "â›”å–æ¶ˆä¸¾æŠ¥";
				reportButton.setAttribute("flag", 1);	
			}else{
				//æ²¡æŠ•è¯‰è¿‡
				reportButton.innerHTML = "â›”ä¸¾æŠ¥";
				reportButton.setAttribute("flag",0);
			}
			reportButton.id = "reportResponse" + i;
			reportButton.setAttribute("onclick","reportResponse("  + responseId + ", "+ i + ");")
			buttonBox.appendChild(reportButton);
			//æ›´æ–°åˆ†é¡µæŒ‰é’®
			updatePageButtons();
        }
	}

	//åˆ›å»ºå›å¤
	function postResponse(){
		//ç”³è¯·äººid
		var authorId = userVO.user.id;
		//å›å¤æ—¶é—´
		var time = new Date();
		var timeString = getTimeString(time);
		//å›å¤å†…å®¹
		var responseContent = document.getElementById("cresponseContent").value;
		var anonymousFlag = 0;//æ˜¯å¦åŒ¿åï¼ˆé»˜è®¤ä¸åŒ¿åï¼‰
		if(document.getElementById("anonymousResp").checked){
			anonymousFlag = 1;
		}
		//å‘é€ç»™åç«¯çš„å›å¤è®°å½•
		var response = {
			"response":{
				"questionId":id,
				"authorId":authorId,
				"createTime":timeString,
				"anonymous":anonymousFlag
			},
			"content":responseContent
		};
		
		$.ajax({
			url: "http://localhost:8888/response",
			type: "post", 
			data:JSON.stringify(response),
			contentType: 'application/json;charset=utf-8',
			beforeSend: function (request) {
				request.setRequestHeader("token", userVO.token);
			},
			success: function (data) {
				if(data.code == 200){//è¯„è®ºæˆåŠŸ
					//å°†è¾“å…¥æ¡†ç½®ä¸ºç©º
					document.getElementById("cresponseContent").value = "";
					//å…³é—­è¯„è®ºè¾“å…¥æ¡†
					$(closeButton).click();
					//åˆ·æ–°é¡µé¢
					location.reload();
				}else if(data.code == 408){
					alert(data.message);
					window.location.href = "index.html";
				}
			},
			error:function(){
				alert("æœåŠ¡å™¨é”™è¯¯,è¯·ç¨åå†è¯•");
			}
		});
	}

	//å…³æ³¨ã€å–æ¶ˆå…³æ³¨é—®é¢˜
	function attentionQuestion(){
		var userId = userVO.user.id;
		//å…³æ³¨æ—¶é—´
		var time = new Date();
		var timeString = getTimeString(time);
		var attentionButton = document.getElementById("attentionQuestion");
		//1-å…³æ³¨  0-å–æ¶ˆå…³æ³¨
		var flag;
		if(attentionButton.getAttribute("flag") == 1){
			//å–æ¶ˆå…³æ³¨
			flag = 0;
			attentionButton.setAttribute("flag", 0);
			attentionButton.innerHTML = "å…³æ³¨é—®é¢˜";

		}else{
			//å…³æ³¨
			var flag = 1;
			attentionButton.setAttribute("flag",1);
			attentionButton.innerHTML = "å–æ¶ˆå…³æ³¨"
		}
		var attention = {
			"userId":userId,
			"questionId":id,
			"createTime":timeString,
			"flag":flag
		}

		$.ajax({
			url: "http://localhost:8888/attention",
			type: "post", 
			data:JSON.stringify(attention),
			contentType: 'application/json;charset=utf-8',
			beforeSend: function (request) {
				request.setRequestHeader("token", userVO.token);
			},
			success: function (data) {
				if(data.code == 408){//å…³æ³¨é—®é¢˜ä¸å­˜åœ¨
					alert(data.message);
					window.location.href = "index.html";
				}
				updateUser(data.data)
        	}
		});
	}

	//ä¸¾æŠ¥ã€å–æ¶ˆä¸¾æŠ¥é—®é¢˜
	function reportQuesion(){
		var userId = userVO.user.id;
		var reportQuestionButton = document.getElementById("reportQuestion");
		//1-æŠ•è¯‰  0-å–æ¶ˆæŠ•è¯‰
		var flag;
		if(reportQuestionButton.getAttribute("flag") == 1){
			//å–æ¶ˆæŠ•è¯‰
			flag = 0;
			reportQuestionButton.setAttribute("flag", 0);
			reportQuestionButton.innerHTML = "ä¸¾æŠ¥é—®é¢˜";
		}else{
			//æŠ•è¯‰
			var flag = 1;
			reportQuestionButton.setAttribute("flag",1);
			reportQuestionButton.innerHTML = "å–æ¶ˆæŠ•è¯‰"
		}
		var reportRecord = {
			"reportorId":userId,
			"questionId":id,
			"flag":flag
		}

		$.ajax({
			url: "http://localhost:8888/questionReport",
			type: "post", 
			data:JSON.stringify(reportRecord),
			beforeSend: function (request) {
				request.setRequestHeader("token", userVO.token);
			},
			contentType: 'application/json;charset=utf-8',
			success: function (data) {
				if(data.code == 408){
					alert("æ‚¨æ“ä½œçš„é—®é¢˜å·²è¢«ç®¡ç†å‘˜åˆ é™¤");
					window.location.href = "index.html";
				}
			},
			error:function(){
				alert("æœåŠ¡å™¨é”™è¯¯,è¯·ç¨åå†è¯•");
			}
		});
	}

	//ä¸¾æŠ¥ã€å–æ¶ˆä¸¾æŠ¥å›å¤ï¼ˆresponseId:è¢«æŠ•è¯‰å›å¤id, i:æœ¬é¡µä¸­çš„ç¬¬iæ¡å›å¤ï¼‰
	function reportResponse(responseId, i){
		var userId = userVO.user.id;
		var reportResponseButton = document.getElementById("reportResponse" + i);
		//1-æŠ•è¯‰  0-å–æ¶ˆæŠ•è¯‰
		var flag;
		if(reportResponseButton.getAttribute("flag") == 1){
			//å–æ¶ˆæŠ•è¯‰
			flag = 0;
			reportResponseButton.setAttribute("flag", 0);
			reportResponseButton.innerHTML = "â›”ä¸¾æŠ¥";
		}else{
			//æŠ•è¯‰
			var flag = 1;
			reportResponseButton.setAttribute("flag",1);
			reportResponseButton.innerHTML = "â›”å–æ¶ˆä¸¾æŠ¥"
		}
		var reportRecord = {
			"reportorId":userId,
			"responseId":responseId,
			"flag":flag
		}

		$.ajax({
			url: "http://localhost:8888/responseReport",
			type: "post", 
			data:JSON.stringify(reportRecord),
			beforeSend: function (request) {
				request.setRequestHeader("token", userVO.token);
			},
			contentType: 'application/json;charset=utf-8',
			success: function (data) {
				if(data.code == 409){
					alert("æ‚¨æ“ä½œçš„å›å¤å·²è¢«ç®¡ç†å‘˜åˆ é™¤");
					location.reload(true);
				}
			},
			error:function(){
				alert("æœåŠ¡å™¨é”™è¯¯,è¯·ç¨åå†è¯•");
			}
		});
	}

	//ç‚¹èµã€ç‚¹ç­å›å¤(responseId:å›å¤id, flag:)
	function likeResponse(responseId, i, type){
		// alert("haha");
		var userId = userVO.user.id;
		var likeButton = document.getElementById("like" + i);
		var disLikeButton = document.getElementById("disLike" + i);

		if(type == "like"){
			console.info("sttribute:" + likeButton.getAttribute("flag"));
			if(likeButton.getAttribute("flag") == 0){
				//ç‚¹èµ
				flag = 1;
				//å–æ¶ˆç‚¹ç­
				disLikeButton.setAttribute("flag", 0);
				disLikeButton.innerHTML = "ğŸ‘ç‚¹ç­"
				//è®¾ç½®å·²èµæ ‡å¿—ä½
				likeButton.setAttribute("flag", 1);
				likeButton.innerHTML ="ğŸ‘å–æ¶ˆç‚¹èµ"
			}else{//å–æ¶ˆç‚¹èµ
				flag = 0;
				//è®¾ç½®ç‚¹èµæ ‡å¿—ä½ä¸º0
				likeButton.setAttribute("flag",0);
				likeButton.innerHTML = "ğŸ‘ç‚¹èµ"
			}
		}else if(type == "disLike"){
			if(disLikeButton.getAttribute("flag") == 0){
				//ç‚¹ç­
				flag = -1;
				//å–æ¶ˆç‚¹èµ
				likeButton.setAttribute("flag",0);
				likeButton.innerHTML = "ğŸ‘ç‚¹èµ"
				//è®¾ç½®ç‚¹ç­æ ‡å¿—ä½
				disLikeButton.setAttribute("flag",1);
				disLikeButton.innerHTML = "ğŸ‘å–æ¶ˆç‚¹ç­"
			}else{
				//å–æ¶ˆç‚¹ç­
				flag = 0;
				//å–æ¶ˆç‚¹ç­æ ‡å¿—ä½
				disLikeButton.setAttribute("flag",0);
				disLikeButton.innerHTML = "ğŸ‘ç‚¹ç­";
			}
		}

		console.info("responseId:" + responseId);

		var likeRecode = {
			"userId":userId,
			"responseId":responseId,
			"flag":flag
		}

		$.ajax({
			url: "http://localhost:8888/likeResponse",
			type: "post", 
			data:JSON.stringify(likeRecode),
			beforeSend: function (request) {
				request.setRequestHeader("token", userVO.token);
			},
			contentType: 'application/json;charset=utf-8',
			success: function (data) {
				if(data.code == 409){//ç‚¹èµå›å¤ä¸å­˜åœ¨
					alert(data.message);
					window.location.reload(true);
				}
        	}
		});
	}

	//æ›´æ–°åˆ†é¡µæŒ‰é’®
	function updatePageButtons(){
    responseDiv.removeChild(pageButtons);
    pageButtons = document.createElement("ul");
    pageButtons.className = "pagination pagination-lg";
    pageButtons.id = "pageButtons";
    responseDiv.insertBefore(pageButtons,divEnd);

    //é¦–é¡µ
    var firstButton = document.createElement("li");
    var firstLink = document.createElement("a");
    firstLink.innerHTML = "é¦–é¡µ";
    firstButton.appendChild(firstLink)
    pageButtons.appendChild(firstButton);
    firstButton.setAttribute("onclick","changePage(" + 1 + ");");

    //ä¸Šä¸€é¡µ
    var preButton = document.createElement("li");
    var preLink = document.createElement("a");
    preLink.innerHTML = "ä¸Šä¸€é¡µ";
    preButton.appendChild(preLink);
    pageButtons.append(preButton);
    preButton.setAttribute("id","previous");

    if(responsePage.hasPrevious == true){//æœ‰ä¸Šä¸€é¡µ
        preButton.setAttribute("onclick", "prePage( 1, " + (responsePage.pageIndex-1) + ");");
    }else{//æ²¡æœ‰ä¸Šä¸€é¡µ
        preButton.setAttribute("onclick", "prePage( 0, " + (responsePage.pageIndex-1) + ");");
    }

    //åˆ†é¡µé¡µç åˆ—è¡¨
    var buttonList = responsePage.buttonList;
    console.info(buttonList);

    for(var i = 0; i < buttonList.length; i++){
        var button_i = document.createElement("li")
        var link_i = document.createElement("a");
        link_i.innerHTML = buttonList[i];
        button_i.appendChild(link_i);
        pageButtons.appendChild(button_i);
        button_i.setAttribute("onclick", "changePage(" + buttonList[i] + ");")
        if(buttonList[i] == responsePage.pageIndex){
            link_i.setAttribute("style","color:red");
        }
    }

    //ä¸‹ä¸€é¡µ
    var nextButton = document.createElement("li");
    var nextLink = document.createElement("a");
    nextLink.innerHTML = "ä¸‹ä¸€é¡µ";
    nextButton.appendChild(nextLink);
    pageButtons.append(nextButton);
    nextButton.setAttribute("id","next")
    nextButton.setAttribute("onclick", "nextPage(" + (responsePage.pageIndex+1) + ");");

    if(responsePage.hasNext == true){//æœ‰ä¸‹ä¸€é¡µ
        nextButton.setAttribute("onclick", "nextPage( 1, " + (responsePage.pageIndex+1) + ");");
    }else{//æ²¡æœ‰ä¸‹ä¸€é¡µ
        nextButton.setAttribute("onclick", "nextPage( 0, " + (responsePage.pageIndex+1) + ");");
    }

    //æœ«é¡µ
    var lastButton = document.createElement("li");
    var lastLink = document.createElement("a");
    lastLink.innerHTML = "æœ«é¡µ";
    lastButton.appendChild(lastLink)
    pageButtons.appendChild(lastButton);
    lastButton.setAttribute("onclick", "changePage(" + responsePage.pageNum + ");")
}

function changePage(index){
    responseDiv.removeChild(responseList);
    responseList = document.createElement("div");
    responseDiv.insertBefore(responseList, pageButtons);
    responseList.setAttribute("id","responseList");
    //pageButtons.removeAttribute("disabled");
    responsePage.pageIndex = index;
    changeQuestionPage(responsePage, responsePath);
}
</script>
</html>